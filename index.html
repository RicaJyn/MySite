<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Gallery</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Raleway:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f8f8;
            --text-primary: #2c2c2c;
            --text-secondary: #666666;
            --accent: #9b8b7e;
            --accent-hover: #7a6d62;
            --border: #e0e0e0;
            --shadow: rgba(0, 0, 0, 0.1);
            --overlay: rgba(0, 0, 0, 0.7);
        }

        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2a2a2a;
            --text-primary: #e8e8e8;
            --text-secondary: #a0a0a0;
            --accent: #b8a896;
            --accent-hover: #cbbead;
            --border: #3a3a3a;
            --shadow: rgba(0, 0, 0, 0.3);
            --overlay: rgba(0, 0, 0, 0.85);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Raleway', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: background 0.4s ease, color 0.4s ease;
            overflow-x: hidden;
        }

        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border);
            padding: 1.5rem 3rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: 1px;
            color: var(--text-primary);
        }

        .header-controls {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }

        .btn {
            padding: 0.7rem 1.8rem;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-primary);
            font-family: 'Raleway', sans-serif;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .btn:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .btn-primary {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .btn-primary:hover {
            background: var(--accent-hover);
            border-color: var(--accent-hover);
        }

        .theme-toggle {
            background: none;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 1.5rem;
            padding: 0.5rem;
            transition: transform 0.3s ease;
        }

        .theme-toggle:hover {
            transform: rotate(180deg);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 7rem 2rem 4rem;
        }

        .album-selector-wrapper {
            display: flex;
            justify-content: center;
            margin-bottom: 3rem;
            opacity: 0;
            animation: fadeIn 0.6s ease forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        .custom-select {
            position: relative;
            min-width: 300px;
            z-index: 2000;
        }

        .select-display {
            padding: 1rem 3rem 1rem 1.5rem;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            text-align: center;
            transition: all 0.3s ease;
            letter-spacing: 0.5px;
            position: relative;
            z-index: 101;
        }

        .select-display:hover {
            border-color: var(--accent);
        }

        .select-display::after {
            content: '‚ñº';
            position: absolute;
            right: 1.5rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.75rem;
            color: var(--text-secondary);
            transition: transform 0.3s ease;
            pointer-events: none;
        }

        .select-display.open::after {
            transform: translateY(-50%) rotate(180deg);
        }

        .select-options {
            position: absolute;
            top: calc(100% + 0.5rem);
            left: 0;
            right: 0;
            background: var(--bg-primary);
            border: 2px solid var(--border);
            max-height: 300px;
            overflow-y: auto;
            display: none;
            z-index: 3000;
            box-shadow: 0 10px 30px var(--shadow);
        }

        .select-options.show {
            display: block;
        }

        .select-option {
            padding: 1rem 1.5rem;
            cursor: pointer;
            transition: background 0.2s ease;
            text-align: center;
            border-bottom: 1px solid var(--border);
            position: relative;
            z-index: 103;
        }

        .select-option:last-child {
            border-bottom: none;
        }

        .select-option:hover {
            background: var(--bg-secondary);
        }

        .select-option.active {
            background: var(--accent);
            color: white;
        }

        .album-info {
            text-align: center;
            margin-bottom: 3rem;
            opacity: 0;
            animation: fadeInUp 0.8s ease 0.2s forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
            from {
                opacity: 0;
                transform: translateY(20px);
            }
        }

        .album-title {
            font-family: 'Playfair Display', serif;
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            letter-spacing: 2px;
        }

        .album-subtitle {
            font-size: 1.25rem;
            color: var(--text-secondary);
            font-weight: 400;
            margin-bottom: 1.5rem;
            font-style: italic;
        }

        .album-description {
            font-size: 1rem;
            color: var(--text-secondary);
            max-width: 700px;
            margin: 0 auto;
            line-height: 1.8;
        }

        .admin-controls {
            display: none;
            gap: 1rem;
            margin-bottom: 3rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .admin-controls.visible {
            display: flex;
        }

        .slideshow-container {
            position: relative;
            max-width: 100%;
            margin: 0 auto;
            opacity: 0;
            animation: fadeInUp 0.8s ease 0.4s forwards;
        }

        .slide-wrapper {
            position: relative;
            width: 100%;
            height: 70vh;
            min-height: 500px;
            background: var(--bg-secondary);
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .slide {
            display: none;
            width: 100%;
            height: 100%;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            transition: opacity 0.6s ease, transform 0.6s ease;
        }

        .slide.active {
            display: flex;
            position: relative;
            opacity: 1;
        }

        .slide.slide-in-left {
            animation: slideInFromLeft 0.6s ease forwards;
        }

        .slide.slide-in-right {
            animation: slideInFromRight 0.6s ease forwards;
        }

        @keyframes slideInFromLeft {
            from {
                opacity: 0;
                transform: translateX(-100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInFromRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .slide img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            cursor: pointer;
        }

        .slide-controls {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: none;
            gap: 0.5rem;
            z-index: 10;
        }

        .admin-controls.visible ~ .slideshow-container .slide-controls {
            display: flex;
        }

        .slide-btn {
            padding: 0.6rem 1rem;
            background: var(--overlay);
            border: none;
            color: white;
            cursor: pointer;
            font-size: 0.875rem;
            transition: background 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .slide-btn:hover {
            background: var(--accent);
        }

        .nav-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: var(--overlay);
            border: none;
            color: white;
            font-size: 2rem;
            padding: 1rem 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 5;
        }

        .nav-btn:hover {
            background: var(--accent);
        }

        .nav-btn.prev {
            left: 1rem;
        }

        .nav-btn.next {
            right: 1rem;
        }

        .slide-counter {
            position: absolute;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: var(--overlay);
            color: white;
            padding: 0.75rem 1.5rem;
            font-size: 0.95rem;
            letter-spacing: 1px;
        }

        .thumbnail-strip {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            overflow-x: auto;
            padding: 1rem 0;
            scrollbar-width: thin;
            scrollbar-color: var(--accent) var(--bg-secondary);
        }

        .thumbnail-strip::-webkit-scrollbar {
            height: 8px;
        }

        .thumbnail-strip::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        .thumbnail-strip::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 4px;
        }

        .thumbnail {
            min-width: 120px;
            height: 80px;
            cursor: pointer;
            opacity: 0.6;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .thumbnail:hover,
        .thumbnail.active {
            opacity: 1;
            border-color: var(--accent);
        }

        .thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--overlay);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal.active {
            display: flex;
            opacity: 1;
        }

        .modal-content {
            background: var(--bg-primary);
            padding: 3rem;
            max-width: 550px;
            width: 90%;
            border: 2px solid var(--border);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            margin-bottom: 2rem;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .form-input,
        .form-textarea {
            width: 100%;
            padding: 1rem;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            color: var(--text-primary);
            font-family: 'Raleway', sans-serif;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--accent);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--overlay);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .lightbox.active {
            display: flex;
            opacity: 1;
        }

        .lightbox-content {
            max-width: 95%;
            max-height: 95%;
            position: relative;
        }

        .lightbox-img {
            max-width: 100%;
            max-height: 95vh;
            object-fit: contain;
        }

        .lightbox-close {
            position: absolute;
            top: -3rem;
            right: 0;
            background: none;
            border: none;
            color: white;
            font-size: 3rem;
            cursor: pointer;
            padding: 0.5rem;
            line-height: 1;
        }

        .empty-state {
            text-align: center;
            padding: 5rem 2rem;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
        }

        .file-upload {
            display: none;
        }

        .notification-modal .modal-content {
            max-width: 450px;
            padding: 2rem;
            text-align: center;
        }

        .notification-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .notification-message {
            font-size: 1rem;
            line-height: 1.6;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
        }

        @media (max-width: 768px) {
            .header {
                padding: 1rem 1.5rem;
            }

            .logo {
                font-size: 1.5rem;
            }

            .album-title {
                font-size: 2.5rem;
            }

            .slide-wrapper {
                height: 50vh;
                min-height: 400px;
            }

            .nav-btn {
                padding: 0.75rem 1rem;
                font-size: 1.5rem;
            }

            .modal-content {
                padding: 2rem;
            }

            .btn {
                padding: 0.6rem 1.2rem;
                font-size: 0.75rem;
            }

            .custom-select {
                min-width: 250px;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">Gallery</div>
        <div class="header-controls">
            <button class="theme-toggle" onclick="toggleTheme()">‚óê</button>
            <button class="btn" id="loginBtn" onclick="showLoginModal()">Admin</button>
            <button class="btn" id="logoutBtn" onclick="logout()" style="display: none;">Logout</button>
        </div>
    </header>

    <div class="container">
        <div class="album-selector-wrapper">
            <div class="custom-select">
                <div class="select-display" onclick="toggleSelect(event)">
                    <span id="selectedAlbum">Select Album</span>
                </div>
                <div class="select-options" id="selectOptions"></div>
            </div>
        </div>

        <div class="album-info">
            <h1 class="album-title" id="albumTitle"></h1>
            <p class="album-subtitle" id="albumSubtitle"></p>
            <p class="album-description" id="albumDescription"></p>
        </div>

        <div class="admin-controls" id="adminControls">
            <button class="btn btn-primary" onclick="showCreateAlbumModal()">Create Album</button>
            <button class="btn" onclick="showEditAlbumModal()">Edit Album</button>
            <button class="btn" onclick="deleteCurrentAlbum()">Delete Album</button>
            <button class="btn" onclick="toggleFavoriteAlbum()">Set as Favorite</button>
            <button class="btn btn-primary" onclick="document.getElementById('photoUpload').click()">Add Photos</button>
            <button class="btn btn-primary" onclick="exportData()">Save Changes</button>
            <input type="file" id="photoUpload" class="file-upload" accept="image/*" multiple onchange="handlePhotoUpload(event)">
        </div>

        <div class="slideshow-container" id="slideshowContainer">
            <div class="slide-wrapper" id="slideWrapper"></div>
            <button class="nav-btn prev" onclick="changeSlide(-1)">‚Äπ</button>
            <button class="nav-btn next" onclick="changeSlide(1)">‚Ä∫</button>
            <div class="slide-counter" id="slideCounter"></div>
            <div class="thumbnail-strip" id="thumbnailStrip"></div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <h2 class="modal-header">Admin Login</h2>
            <div class="form-group">
                <label class="form-label">Username</label>
                <input type="text" class="form-input" id="username" placeholder="Enter username">
            </div>
            <div class="form-group">
                <label class="form-label">Password</label>
                <input type="password" class="form-input" id="password" placeholder="Enter password">
            </div>
            <div class="form-actions">
                <button class="btn btn-primary" onclick="login()">Login</button>
                <button class="btn" onclick="closeModal('loginModal')">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Create/Edit Album Modal -->
    <div class="modal" id="albumModal">
        <div class="modal-content">
            <h2 class="modal-header" id="albumModalTitle">Create Album</h2>
            <div class="form-group">
                <label class="form-label">Title *</label>
                <input type="text" class="form-input" id="albumTitleInput" placeholder="Enter album title">
            </div>
            <div class="form-group">
                <label class="form-label">Subtitle</label>
                <input type="text" class="form-input" id="albumSubtitleInput" placeholder="Enter subtitle (optional)">
            </div>
            <div class="form-group">
                <label class="form-label">Description</label>
                <textarea class="form-textarea" id="albumDescriptionInput" placeholder="Enter description (optional)"></textarea>
            </div>
            <div class="form-actions">
                <button class="btn btn-primary" onclick="saveAlbum()">Save</button>
                <button class="btn" onclick="closeModal('albumModal')">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Notification Modal -->
    <div class="modal notification-modal" id="notificationModal">
        <div class="modal-content">
            <div class="notification-icon" id="notificationIcon">‚ÑπÔ∏è</div>
            <div class="notification-message" id="notificationMessage"></div>
            <button class="btn btn-primary" onclick="closeModal('notificationModal')" style="width: 100%;">OK</button>
        </div>
    </div>

    <!-- Lightbox -->
    <div class="lightbox" id="lightbox" onclick="closeLightbox()">
        <div class="lightbox-content" onclick="event.stopPropagation()">
            <button class="lightbox-close" onclick="closeLightbox()">√ó</button>
            <img class="lightbox-img" id="lightboxImg" src="" alt="">
        </div>
    </div>

    <script>
        // ALBUMS_DATA_START
        let ALBUMS_DATA = [
            {
                folderName: "My-Collection",
                title: "My Collection",
                subtitle: "A curated selection",
                description: "Welcome to my photo gallery",
                isFavorite: true
            }
        ];
        // ALBUMS_DATA_END
        
        const STORED_PASSWORD_HASH = "0979f26609b496b1e58207a0acaf4819b8bdf72efbb57004136dba0acd469810";

        async function hashPassword(password) {
            const encoder = new TextEncoder();
            const data = encoder.encode(password);
            const hash = await crypto.subtle.digest('SHA-256', data);
            return Array.from(new Uint8Array(hash))
                .map(b => b.toString(16).padStart(2, '0'))
                .join('');
        }

        const ADMIN_USERNAME = 'ricajyn';
        
        let albums = [];
        let currentAlbumIndex = 0;
        let currentSlideIndex = 0;
        let isAdmin = false;
        let editingAlbumIndex = null;
        let slideDirection = 1;
        let lightboxIndex = 0;

                
        function resetToUserMode() {
            isAdmin = false;
            document.getElementById('loginBtn').style.display = 'block';
            document.getElementById('logoutBtn').style.display = 'none';
            document.getElementById('adminControls').classList.remove('visible');
        }

        async function init() {
            resetToUserMode()
            albums = JSON.parse(JSON.stringify(ALBUMS_DATA));
            
            // Auto-load photos from folders
            await loadPhotosFromFolders();
            
            const favoriteIndex = albums.findIndex(a => a.isFavorite);
            currentAlbumIndex = favoriteIndex >= 0 ? favoriteIndex : 0;
            
            checkTheme();
            displayAlbumSelector();
            displayCurrentAlbum();
        }

        async function loadPhotosFromFolders() {
            for (let album of albums) {
                try {
                    const response = await fetch(`images/${album.folderName}/`);
                    if (response.ok) {
                        const text = await response.text();
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(text, 'text/html');
                        const links = doc.querySelectorAll('a');
                        const photos = [];
                        
                        links.forEach(link => {
                            const href = link.getAttribute('href');
                            if (href && /\.(jpg|jpeg|png|gif|webp)$/i.test(href)) {
                                photos.push(href);
                            }
                        });
                        
                        if (photos.length > 0) {
                            album.photos = photos;
                        }
                    }
                } catch (error) {
                    console.log(`Could not auto-load photos for ${album.folderName}`);
                }
            }
        }

        function createFolderName(title) {
            return title.replace(/[^a-zA-Z0-9]/g, '-').replace(/-+/g, '-').replace(/^-|-$/g, '');
        }

        function showNotification(message, icon = '‚ÑπÔ∏è') {
            document.getElementById('notificationIcon').textContent = icon;
            document.getElementById('notificationMessage').textContent = message;
            document.getElementById('notificationModal').classList.add('active');
        }

        function displayAlbumSelector() {
            const options = document.getElementById('selectOptions');
            const display = document.getElementById('selectedAlbum');
            options.innerHTML = '';
            
            albums.forEach((album, index) => {
                const option = document.createElement('div');
                option.className = 'select-option' + (index === currentAlbumIndex ? ' active' : '');
                option.textContent = album.title + (album.isFavorite ? ' ‚òÖ' : '');
                option.onclick = (e) => {
                    e.stopPropagation();
                    selectAlbum(index);
                };
                options.appendChild(option);
            });

            const currentAlbum = albums[currentAlbumIndex];
            if (currentAlbum) {
                display.textContent = currentAlbum.title + (currentAlbum.isFavorite ? ' ‚òÖ' : '');
            }
        }

        function toggleSelect(e) {
            e.stopPropagation();
            const options = document.getElementById('selectOptions');
            const display = document.querySelector('.select-display');
            options.classList.toggle('show');
            display.classList.toggle('open');
        }

        function selectAlbum(index) {
            currentAlbumIndex = index;
            currentSlideIndex = 0;
            const options = document.getElementById('selectOptions');
            const display = document.querySelector('.select-display');
            options.classList.remove('show');
            display.classList.remove('open');
            displayAlbumSelector();
            displayCurrentAlbum();
        }

        function displayCurrentAlbum() {
            const album = albums[currentAlbumIndex];
            if (!album) {
                document.getElementById('albumTitle').textContent = '';
                document.getElementById('albumSubtitle').textContent = '';
                document.getElementById('albumDescription').textContent = '';
                document.getElementById('slideWrapper').innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì∑</div><p>No album selected</p></div>';
                return;
            }

            document.getElementById('albumTitle').textContent = album.title;
            document.getElementById('albumSubtitle').textContent = album.subtitle || '';
            document.getElementById('albumDescription').textContent = album.description || '';

            if (!album.photos || album.photos.length === 0) {
                document.getElementById('slideWrapper').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì∑</div>
                        <p>No photos in this album</p>
                        ${isAdmin ? '<p style="margin-top: 1rem;">Click "Add Photos" to upload images</p>' : ''}
                    </div>
                `;
                document.getElementById('thumbnailStrip').innerHTML = '';
                document.getElementById('slideCounter').style.display = 'none';
                return;
            }

            displaySlideshow(album);
        }

        function displaySlideshow(album) {
            const wrapper = document.getElementById('slideWrapper');
            wrapper.innerHTML = '';

            album.photos.forEach((photoName, index) => {
                const photoPath = `images/${album.folderName}/${photoName}`;
                const slide = document.createElement('div');
                const img = slide.querySelector('img');

                addSwipeSupport(img,
                    () => changeSlide(1),
                    () => changeSlide(-1)
                );

                // slide.className = 'slide' + (index === currentSlideIndex ? ' active' : '');
                // slide.innerHTML = `
                //     <img src="${photoPath}" alt="${photoName}" onclick="openLightbox('${photoPath}')" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'400\\' height=\\'300\\'%3E%3Crect fill=\\'%23ddd\\' width=\\'400\\' height=\\'300\\'/%3E%3Ctext x=\\'50%25\\' y=\\'50%25\\' text-anchor=\\'middle\\' dy=\\'.3em\\' fill=\\'%23999\\'%3EImage not found%3C/text%3E%3C/svg%3E'">
                //     <div class="slide-controls">
                //         ${index > 0 ? `<button class="slide-btn" onclick="event.stopPropagation(); movePhoto(${index}, -1)">Move Left</button>` : ''}
                //         ${index < album.photos.length - 1 ? `<button class="slide-btn" onclick="event.stopPropagation(); movePhoto(${index}, 1)">Move Right</button>` : ''}
                //         <button class="slide-btn" onclick="event.stopPropagation(); deletePhoto(${index})">Delete</button>
                //     </div>
                // `;
                wrapper.appendChild(slide);
            });

            updateSlideCounter();
            displayThumbnails(album);
        }

        function displayThumbnails(album) {
            const strip = document.getElementById('thumbnailStrip');
            strip.innerHTML = '';

            album.photos.forEach((photoName, index) => {
                const photoPath = `images/${album.folderName}/${photoName}`;
                const thumb = document.createElement('div');
                thumb.className = 'thumbnail' + (index === currentSlideIndex ? ' active' : '');
                thumb.innerHTML = `<img src="${photoPath}" alt="${photoName}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'120\\' height=\\'80\\'%3E%3Crect fill=\\'%23ddd\\' width=\\'120\\' height=\\'80\\'/%3E%3C/svg%3E'">`;
                thumb.onclick = () => goToSlide(index);
                strip.appendChild(thumb);
            });
        }

        function changeSlide(direction) {
            const album = albums[currentAlbumIndex];
            if (!album || !album.photos || album.photos.length === 0) return;

            slideDirection = direction;
            currentSlideIndex += direction;
            if (currentSlideIndex < 0) currentSlideIndex = album.photos.length - 1;
            if (currentSlideIndex >= album.photos.length) currentSlideIndex = 0;

            showSlide();
        }

        function goToSlide(index) {
            slideDirection = index > currentSlideIndex ? 1 : -1;
            currentSlideIndex = index;
            showSlide();
        }

        function showSlide() {
            const slides = document.querySelectorAll('.slide');
            const thumbnails = document.querySelectorAll('.thumbnail');
            
            slides.forEach((slide, index) => {
                slide.classList.remove('active', 'slide-out-left', 'slide-out-right', 'slide-in-left', 'slide-in-right');
                
                if (index === currentSlideIndex) {
                    slide.classList.add('active');
                    if (slideDirection === 1) {
                        slide.classList.add('slide-in-right');
                    } else {
                        slide.classList.add('slide-in-left');
                    }
                }
            });

            thumbnails.forEach((thumb, index) => {
                thumb.classList.toggle('active', index === currentSlideIndex);
            });

            updateSlideCounter();
            
            const activeThumb = document.querySelector('.thumbnail.active');
            if (activeThumb) {
                activeThumb.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
            }
        }

        function updateSlideCounter() {
            const album = albums[currentAlbumIndex];
            const counter = document.getElementById('slideCounter');
            
            if (album && album.photos && album.photos.length > 0) {
                counter.textContent = `${currentSlideIndex + 1} / ${album.photos.length}`;
                counter.style.display = 'block';
            } else {
                counter.style.display = 'none';
            }
        }

        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (username !== ADMIN_USERNAME) {
                showNotification('Invalid username or password', '‚ùå');
                return;
            }

            const hash = await hashPassword(password);

            if (hash === STORED_PASSWORD_HASH) {
                isAdmin = true;
                document.getElementById('loginBtn').style.display = 'none';
                document.getElementById('logoutBtn').style.display = 'block';
                document.getElementById('adminControls').classList.add('visible');
                closeModal('loginModal');
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                showNotification('Welcome back, Admin!', '‚úÖ');
            } else {
                showNotification('Invalid username or password', '‚ùå');
            }
        }

        function logout() {
            isAdmin = false;
            document.getElementById('loginBtn').style.display = 'block';
            document.getElementById('logoutBtn').style.display = 'none';
            document.getElementById('adminControls').classList.remove('visible');
            showNotification('Logged out successfully', 'üëã');
        }

        function showLoginModal() {
            document.getElementById('loginModal').classList.add('active');
        }

        function showCreateAlbumModal() {
            editingAlbumIndex = null;
            document.getElementById('albumModalTitle').textContent = 'Create Album';
            document.getElementById('albumTitleInput').value = '';
            document.getElementById('albumSubtitleInput').value = '';
            document.getElementById('albumDescriptionInput').value = '';
            document.getElementById('albumModal').classList.add('active');
        }

        function showEditAlbumModal() {
            const album = albums[currentAlbumIndex];
            if (!album) return;

            editingAlbumIndex = currentAlbumIndex;
            document.getElementById('albumModalTitle').textContent = 'Edit Album';
            document.getElementById('albumTitleInput').value = album.title;
            document.getElementById('albumSubtitleInput').value = album.subtitle || '';
            document.getElementById('albumDescriptionInput').value = album.description || '';
            document.getElementById('albumModal').classList.add('active');
        }

        function saveAlbum() {
            const title = document.getElementById('albumTitleInput').value.trim();
            if (!title) {
                showNotification('Album title is required', '‚ö†Ô∏è');
                return;
            }

            const subtitle = document.getElementById('albumSubtitleInput').value.trim();
            const description = document.getElementById('albumDescriptionInput').value.trim();
            const folderName = createFolderName(title);

            if (editingAlbumIndex !== null) {
                const album = albums[editingAlbumIndex];
                if (album) {
                    album.title = title;
                    album.subtitle = subtitle;
                    album.description = description;
                    album.folderName = folderName;
                }
                showNotification('Album updated successfully!', '‚úÖ');
            } else {
                const newAlbum = {
                    folderName,
                    title,
                    subtitle,
                    description,
                    photos: [],
                    isFavorite: false
                };
                albums.push(newAlbum);
                currentAlbumIndex = albums.length - 1;
                showNotification(`Album created! Remember to create the folder: images/${folderName}/`, '‚úÖ');
            }

            displayAlbumSelector();
            displayCurrentAlbum();
            closeModal('albumModal');
        }

        function deleteCurrentAlbum() {
            if (albums.length === 1) {
                showNotification('Cannot delete the last album', '‚ö†Ô∏è');
                return;
            }

            const album = albums[currentAlbumIndex];
            
            // Create a custom confirmation modal
            const confirmMsg = `Delete album "${album.title}"?\n\nThis will remove it from the gallery. The images/${album.folderName}/ folder will remain in GitHub.`;
            
            if (confirm(confirmMsg)) {
                albums.splice(currentAlbumIndex, 1);
                currentAlbumIndex = 0;
                currentSlideIndex = 0;
                displayAlbumSelector();
                displayCurrentAlbum();
                showNotification('Album deleted successfully', '‚úÖ');
            }
        }

        function toggleFavoriteAlbum() {
            albums.forEach(a => a.isFavorite = false);
            const album = albums[currentAlbumIndex];
            if (album) {
                album.isFavorite = true;
                showNotification(`"${album.title}" is now the default album`, '‚≠ê');
            }
            displayAlbumSelector();
        }

        function handlePhotoUpload(event) {
            const files = event.target.files;
            if (!files.length) return;

            const album = albums[currentAlbumIndex];
            if (!album) return;

            if (!album.photos) album.photos = [];

            let processed = 0;
            const totalFiles = files.length;

            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const fileName = file.name;
                    album.photos.push(fileName);
                    
                    // Store as base64 for temporary viewing
                    // In real usage, these would be uploaded to GitHub
                    const img = new Image();
                    img.src = e.target.result;
                    
                    processed++;
                    if (processed === totalFiles) {
                        displayCurrentAlbum();
                        showNotification(`${totalFiles} photo(s) added! Remember to click "Save Changes" and upload these files to images/${album.folderName}/ in GitHub.`, '‚úÖ');
                    }
                };
                reader.readAsDataURL(file);
            });

            event.target.value = '';
        }

        function movePhoto(index, direction) {
            const album = albums[currentAlbumIndex];
            if (!album || !album.photos) return;

            const newIndex = index + direction;
            if (newIndex < 0 || newIndex >= album.photos.length) return;

            [album.photos[index], album.photos[newIndex]] = [album.photos[newIndex], album.photos[index]];
            
            if (currentSlideIndex === index) {
                currentSlideIndex = newIndex;
            } else if (currentSlideIndex === newIndex) {
                currentSlideIndex = index;
            }
            
            displayCurrentAlbum();
        }

        function deletePhoto(index) {
            const album = albums[currentAlbumIndex];
            if (!album || !album.photos) return;
            
            if (confirm(`Delete "${album.photos[index]}"?\n\nYou should also delete this file from images/${album.folderName}/ in GitHub.`)) {
                album.photos.splice(index, 1);
                
                if (currentSlideIndex >= album.photos.length) {
                    currentSlideIndex = Math.max(0, album.photos.length - 1);
                }
                
                displayCurrentAlbum();
                showNotification('Photo removed from gallery', '‚úÖ');
            }
        }

        function exportData() {
            const albumsJSON = JSON.stringify(albums, null, 2);
            
            const htmlContent = document.documentElement.outerHTML
                .replace(/\/\/ ALBUMS_DATA_START[\s\S]*?\/\/ ALBUMS_DATA_END/m, 
                    `// ALBUMS_DATA_START\n        let ALBUMS_DATA = ${albumsJSON};\n        // ALBUMS_DATA_END`);
            
            const htmlBlob = new Blob([htmlContent], { type: 'text/html' });
            const htmlUrl = URL.createObjectURL(htmlBlob);
            const htmlLink = document.createElement('a');
            htmlLink.href = htmlUrl;
            htmlLink.download = 'index.html';
            document.body.appendChild(htmlLink);
            htmlLink.click();
            document.body.removeChild(htmlLink);
            URL.revokeObjectURL(htmlUrl);
            
            showNotification('Gallery data saved! Upload the downloaded index.html to your GitHub repository to save your changes.', 'üíæ');
        }

        function openLightbox(src) {
            const album = albums[currentAlbumIndex];
            lightboxIndex = album.photos.findIndex(p => src.includes(p));

            document.getElementById('lightboxImg').src = src;
            document.getElementById('lightbox').classList.add('active');

            addSwipeSupport(
                document.getElementById('lightboxImg'),
                () => navigateLightbox(1),
                () => navigateLightbox(-1)
            );
        }

        function navigateLightbox(direction) {
            const album = albums[currentAlbumIndex];
            if (!album || !album.photos.length) return;

            lightboxIndex += direction;
            if (lightboxIndex < 0) lightboxIndex = album.photos.length - 1;
            if (lightboxIndex >= album.photos.length) lightboxIndex = 0;

            document.getElementById('lightboxImg').src =
                `images/${album.folderName}/${album.photos[lightboxIndex]}`;

            currentSlideIndex = lightboxIndex;
            showSlide();
        }


        function closeLightbox() {
            document.getElementById('lightbox').classList.remove('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        function checkTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
        }

        document.addEventListener('click', (e) => {
            const select = document.querySelector('.custom-select');
            if (select && !select.contains(e.target)) {
                const options = document.getElementById('selectOptions');
                const display = document.querySelector('.select-display');
                if (options && display) {
                    options.classList.remove('show');
                    display.classList.remove('open');
                }
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal('loginModal');
                closeModal('albumModal');
                closeModal('notificationModal');
                closeLightbox();
            }
            if (e.key === 'ArrowLeft') changeSlide(-1);
            if (e.key === 'ArrowRight') changeSlide(1);
        });

        function addSwipeSupport(element, onSwipeLeft, onSwipeRight) {
            let startX = 0;
            let isDown = false;

            element.addEventListener('pointerdown', e => {
                isDown = true;
                startX = e.clientX;
                element.setPointerCapture(e.pointerId);
            });

            element.addEventListener('pointerup', e => {
                if (!isDown) return;
                const diff = e.clientX - startX;
                isDown = false;

                if (Math.abs(diff) > 50) {
                    diff < 0 ? onSwipeLeft() : onSwipeRight();
                }
            });

            element.addEventListener('pointercancel', () => {
                isDown = false;
            });
        }

        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
